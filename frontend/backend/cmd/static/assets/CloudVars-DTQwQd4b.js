import{_ as A,k as ee,r as y,A as J,j as $,f as c,c as x,o as V,i as O,F as P,B as z,b as h,e as l,C as le,t as R,w as s,q as C,p as b,D as H,I as K,J as te,H as ae,K as oe,L as se,m as U,M as ne,l as de,P as ie,N as re,s as q,E as D}from"./index-IB4G3YSI.js";import{s as ue,A as ce,a as ve,u as me,g as pe}from"./animations-CK8lbZP1.js";import{r as E}from"./request-C3WSFEwG.js";import{u as L}from"./useResponsive-D_ioosfI.js";function fe(o){return E({url:"/admin/cloud-vars",method:"get",params:o})}function _e(o){return E({url:"/admin/cloud-vars",method:"post",data:o})}function ye(o){return E({url:`/admin/cloud-vars/${o}`,method:"delete"})}function ge(o){return E({url:"/admin/cloud-vars/batch",method:"post",data:o})}function be(o){return E({url:"/admin/cloud-vars/batch",method:"delete",data:o})}const Ve={class:"card-header"},he={class:"card-title"},ke={class:"var-key"},Ce={class:"card-body"},we={class:"var-value"},xe={class:"value-content"},Se={class:"card-footer"},Be={key:0,class:"loading-state"},Ie={key:1,class:"empty-state"},De={__name:"CloudVarCardList",props:{cloudVars:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},selectedVars:{type:Array,default:()=>[]}},emits:["selection-change","edit","delete"],setup(o,{emit:k}){const _=o,g=k,v=ee({get:()=>_.selectedVars.map(i=>i.id),set:i=>{const e=_.cloudVars.filter(n=>i.includes(n.id));g("selection-change",e)}}),t=y(null);J(()=>{r()}),$(()=>_.cloudVars,()=>{_.cloudVars.length>0&&setTimeout(()=>{r()},50)});const r=()=>{if(t.value){const i=t.value.querySelectorAll(".cloudvar-card");i.length>0&&ue(i,{stagger:.05,ease:"back.out(1.7)"})}};return(i,e)=>{const n=c("el-checkbox"),m=c("el-icon"),u=c("el-button");return V(),x("div",{class:"cloudvar-card-list",ref_key:"cardListRef",ref:t},[(V(!0),x(P,null,z(o.cloudVars,a=>(V(),x("div",{key:a.id,class:"cloudvar-card"},[h("div",Ve,[h("div",he,[l(n,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=f=>v.value=f),label:a.id,onClick:e[1]||(e[1]=le(()=>{},["stop"])),class:"card-checkbox"},null,8,["modelValue","label"]),h("span",ke,R(a.key),1)])]),h("div",Ce,[h("div",we,[e[2]||(e[2]=h("span",{class:"label"},"值:",-1)),h("div",xe,R(a.value),1)])]),h("div",Se,[l(u,{size:"small",type:"primary",onClick:f=>i.$emit("edit",a)},{default:s(()=>[l(m,null,{default:s(()=>[l(b(H))]),_:1}),e[3]||(e[3]=C(" 编辑 ",-1))]),_:1},8,["onClick"]),l(u,{size:"small",type:"danger",onClick:f=>i.$emit("delete",a)},{default:s(()=>[l(m,null,{default:s(()=>[l(b(K))]),_:1}),e[4]||(e[4]=C(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128)),o.loading?(V(),x("div",Be,[l(m,{class:"is-loading"},{default:s(()=>[l(b(te))]),_:1}),e[5]||(e[5]=h("span",null,"加载中...",-1))])):O("",!0),!o.loading&&o.cloudVars.length===0?(V(),x("div",Ie,[l(m,null,{default:s(()=>[l(b(ae))]),_:1}),e[6]||(e[6]=h("span",null,"暂无云变量",-1))])):O("",!0)],512)}}},$e=A(De,[["__scopeId","data-v-c31a7423"]]),Ae={__name:"CloudVarTable",props:{cloudVars:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["selection-change","edit","delete"],setup(o,{emit:k}){const{isMobile:_,isDesktop:g}=L(),v=y([]),t=k,r=e=>{v.value=e,t("selection-change",e)},i=e=>[{key:"edit",icon:H,label:"编辑",handler:()=>t("edit",e)},{key:"delete",icon:K,label:"删除",type:"danger",divided:!0,handler:()=>t("delete",e)}];return(e,n)=>{const m=c("el-table-column"),u=c("el-table"),a=oe("loading");return V(),x("div",null,[b(_)?(V(),U($e,{key:1,"cloud-vars":o.cloudVars,loading:o.loading,"selected-vars":v.value,onSelectionChange:r,onEdit:n[0]||(n[0]=f=>e.$emit("edit",f)),onDelete:n[1]||(n[1]=f=>e.$emit("delete",f))},null,8,["cloud-vars","loading","selected-vars"])):se((V(),U(u,{key:0,data:o.cloudVars,style:{width:"100%"},onSelectionChange:r},{default:s(()=>[l(m,{type:"selection",width:"55"}),l(m,{prop:"key",label:"变量名","min-width":"200","show-overflow-tooltip":""}),l(m,{prop:"value",label:"值","min-width":"250","show-overflow-tooltip":""}),l(m,{label:"操作",width:"150",fixed:b(g)?"right":!1,"class-name":"action-column"},{default:s(({row:f})=>[l(ce,{actions:i(f)},null,8,["actions"])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[a,o.loading]])])}}},Ee=A(Ae,[["__scopeId","data-v-e9430228"]]),Te={class:"modern-dialog theme-info"},je={__name:"CloudVarFormDialog",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"添加变量"},isEdit:{type:Boolean,default:!1},varData:{type:Object,default:null}},emits:["update:visible","save"],setup(o,{emit:k}){const{isMobile:_}=L(),g=o,v=k,t=y(!1),r=y({key:"",value:""});$(()=>g.visible,u=>{t.value=u,u&&(g.varData?r.value={...g.varData}:i())}),$(t,u=>{v("update:visible",u)});const i=()=>{r.value={key:"",value:""}},e=()=>{t.value=!1},n=()=>{v("save",r.value)},m=()=>{ne(()=>{const u=document.querySelectorAll(".el-form-item");u.length>0&&ve(u)})};return(u,a)=>{const f=c("el-input"),S=c("el-form-item"),B=c("el-form"),T=c("el-button"),N=c("el-dialog");return V(),x("div",Te,[l(N,{modelValue:t.value,"onUpdate:modelValue":a[2]||(a[2]=I=>t.value=I),title:o.title,width:b(_)?"95%":"600px",fullscreen:b(_),"close-on-click-modal":!1,onClose:e,onOpened:m},{footer:s(()=>[l(T,{onClick:e},{default:s(()=>[...a[3]||(a[3]=[C("取消",-1)])]),_:1}),l(T,{type:"primary",onClick:n},{default:s(()=>[...a[4]||(a[4]=[C("确定",-1)])]),_:1})]),default:s(()=>[l(B,{model:r.value,"label-width":b(_)?"0px":"100px","label-position":b(_)?"top":"right"},{default:s(()=>[l(S,{label:"变量名"},{default:s(()=>[l(f,{modelValue:r.value.key,"onUpdate:modelValue":a[0]||(a[0]=I=>r.value.key=I),disabled:o.isEdit},null,8,["modelValue","disabled"])]),_:1}),l(S,{label:"值"},{default:s(()=>[l(f,{modelValue:r.value.value,"onUpdate:modelValue":a[1]||(a[1]=I=>r.value.value=I),type:"textarea",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-width","label-position"])]),_:1},8,["modelValue","title","width","fullscreen"])])}}},Me=A(je,[["__scopeId","data-v-30c45d49"]]),Ue={__name:"CloudVarBatchImportDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(o,{emit:k}){const _=o,g=k,v=y(!1),t=y("");$(()=>_.visible,e=>{v.value=e,e&&(t.value="")}),$(v,e=>{g("update:visible",e)});const r=()=>{v.value=!1},i=()=>{g("save",t.value)};return(e,n)=>{const m=c("el-alert"),u=c("el-input"),a=c("el-button"),f=c("el-dialog");return V(),U(f,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=S=>v.value=S),title:"批量导入变量",width:"700px",onClose:r},{footer:s(()=>[l(a,{onClick:r},{default:s(()=>[...n[3]||(n[3]=[C("取消",-1)])]),_:1}),l(a,{type:"primary",onClick:i},{default:s(()=>[...n[4]||(n[4]=[C("确定导入",-1)])]),_:1})]),default:s(()=>[l(m,{type:"info",closable:!1,style:{"margin-bottom":"15px"}},{default:s(()=>[...n[2]||(n[2]=[C(' 请输入JSON格式的变量数据,格式: [{"key": "变量名", "value": "值"}, ...] ',-1)])]),_:1}),l(u,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=S=>t.value=S),type:"textarea",rows:12,placeholder:`[\r
  {"key": "api_url", "value": "https://api.example.com"},\r
  {"key": "app_name", "value": "MyApp"},\r
  {"key": "version", "value": "1.0.0"}\r
]`},null,8,["modelValue"])]),_:1},8,["modelValue"])}}},Ne=A(Ue,[["__scopeId","data-v-b04ec39a"]]),Fe={class:"page-container"},Le={class:"header-actions"},Oe={__name:"CloudVars",setup(o){const k=de(),{isMobile:_}=L(),g=y(!1),v=y([]),t=y(null),r=y([]),i=y(!1),e=y(!1),n=y(""),m=y(!1),u=y(null),{selectedItems:a,handleSelectionChange:f}=me(),S=async()=>{try{v.value=await pe(),k.params.projectId&&(t.value=parseInt(k.params.projectId),B())}catch(p){console.error(p)}},B=async()=>{if(t.value){g.value=!0;try{r.value=await fe({project_id:t.value})}catch(p){console.error(p)}finally{g.value=!1}}},T=()=>{m.value=!1,n.value="添加变量",u.value=null,i.value=!0},N=p=>{m.value=!0,n.value="编辑变量",u.value={...p},i.value=!0},I=async p=>{try{await _e({project_id:t.value,key:p.key,value:p.value}),D.success("保存成功"),i.value=!1,B()}catch(d){console.error(d)}},G=p=>{q.confirm("确定要删除该变量吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ye(p.id),D.success("删除成功"),B()}catch(d){console.error(d)}}).catch(()=>{})},Q=()=>{e.value=!0},W=async p=>{try{const d=JSON.parse(p);if(!Array.isArray(d)){D.error("数据格式错误,必须是数组");return}const j=d.map(M=>({project_id:t.value,key:M.key,value:M.value}));await ge({data:j}),D.success(`成功导入 ${j.length} 个变量`),e.value=!1,B()}catch(d){d instanceof SyntaxError?D.error("JSON格式错误,请检查"):console.error(d)}},X=()=>{q.confirm(`确定要删除选中的 ${a.value.length} 个变量吗?`,"批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await be({ids:a.value.map(p=>p.id)}),D.success(`成功删除 ${a.value.length} 个变量`),a.value=[],B()}catch(p){console.error(p)}}).catch(()=>{})};return J(()=>{S()}),(p,d)=>{const j=c("el-option"),M=c("el-select"),Y=c("el-icon"),F=c("el-button"),Z=c("el-card");return V(),x("div",Fe,[l(Z,null,{default:s(()=>[h("div",Le,[l(M,{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=w=>t.value=w),placeholder:"选择项目",style:ie(b(_)?"width: 100%; order: -1;":"width: 300px; margin-right: 10px;"),onChange:B},{default:s(()=>[(V(!0),x(P,null,z(v.value,w=>(V(),U(j,{key:w.id,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","style"]),l(F,{type:"primary",onClick:T,disabled:!t.value},{default:s(()=>[l(Y,null,{default:s(()=>[l(b(re))]),_:1}),d[3]||(d[3]=C(" 添加变量 ",-1))]),_:1},8,["disabled"]),l(F,{type:"success",onClick:Q,disabled:!t.value,style:{"margin-left":"10px"}},{default:s(()=>[...d[4]||(d[4]=[C(" 批量导入 ",-1)])]),_:1},8,["disabled"]),l(F,{type:"danger",onClick:X,disabled:b(a).length===0},{default:s(()=>[...d[5]||(d[5]=[C(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),l(Ee,{"cloud-vars":r.value,loading:g.value,onSelectionChange:b(f),onEdit:N,onDelete:G},null,8,["cloud-vars","loading","onSelectionChange"])]),_:1}),l(Me,{visible:i.value,"onUpdate:visible":d[1]||(d[1]=w=>i.value=w),title:n.value,"is-edit":m.value,"var-data":u.value,onSave:I},null,8,["visible","title","is-edit","var-data"]),l(Ne,{visible:e.value,"onUpdate:visible":d[2]||(d[2]=w=>e.value=w),onSave:W},null,8,["visible"])])}}},ze=A(Oe,[["__scopeId","data-v-51d8ff1e"]]);export{ze as default};
