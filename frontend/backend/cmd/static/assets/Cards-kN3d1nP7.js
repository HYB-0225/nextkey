import{r as S,_ as O,k as ce,A as X,j as q,f as s,c as M,o as f,i as T,m as N,F as R,B as J,b as g,e,C as ve,t as $,w as a,q as _,p as y,D as Y,O as Z,I as ee,J as _e,G as fe,K as be,L as ge,M as le,l as ye,P as xe,N as Ve,s as W,E as F}from"./index-IB4G3YSI.js";import{s as we,A as Ce,a as te,u as he,g as ke}from"./animations-CK8lbZP1.js";import{r as D}from"./request-C3WSFEwG.js";import{u as G}from"./useResponsive-D_ioosfI.js";function Ue(o){return D({url:"/admin/cards",method:"get",params:o})}function $e(o){return D({url:"/admin/cards",method:"post",data:o})}function Se(o,C){return D({url:`/admin/cards/${o}`,method:"put",data:C})}function ze(o){return D({url:`/admin/cards/${o}`,method:"delete"})}function Ie(o){return D({url:"/admin/cards/batch",method:"put",data:o})}function Pe(o){return D({url:"/admin/cards/batch",method:"delete",data:o})}function Be(o=20){const C=S(1),c=S(o),B=S(0);return{page:C,pageSize:c,total:B,handlePageChange:t=>{C.value=t},resetPage:()=>{C.value=1}}}const Me={second:{label:"秒",value:1},day:{label:"天",value:86400},week:{label:"周",value:604800},month:{label:"月",value:2592e3},quarter:{label:"季",value:7776e3},year:{label:"年",value:31536e3}};function Q(o){if(o===0)return"永久";const C=[{name:"年",value:31536e3},{name:"季",value:7776e3},{name:"月",value:2592e3},{name:"周",value:604800},{name:"天",value:86400}];for(const c of C)if(o%c.value===0)return`${o/c.value}${c.name}`;return`${o}秒`}function Te(o){if(o===0)return{value:0,unit:"day"};const C=[{key:"year",value:31536e3},{key:"quarter",value:7776e3},{key:"month",value:2592e3},{key:"week",value:604800},{key:"day",value:86400}];for(const c of C)if(o%c.value===0)return{value:o/c.value,unit:c.key};return{value:o,unit:"second"}}function H(o,C){var c;return o*(((c=Me[C])==null?void 0:c.value)||1)}const Ne={class:"card-header"},je={class:"card-title"},Ee={class:"card-key"},qe={class:"card-body"},Ae={class:"info-row"},Oe={class:"value"},Le={class:"info-row"},Fe={class:"value"},Re={class:"info-row"},De={class:"value"},Ge={class:"info-row"},Je={class:"value"},Ke={key:0,class:"info-row"},He={class:"value note-text"},Qe={class:"card-footer"},We={key:0,class:"loading-state"},Xe={key:1,class:"empty-state"},Ye={__name:"CardListMobile",props:{cards:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},page:{type:Number,default:1},pageSize:{type:Number,default:20},total:{type:Number,default:0},selectedCards:{type:Array,default:()=>[]}},emits:["selection-change","page-change","edit","view","delete"],setup(o,{emit:C}){const c=o,B=C,z=ce({get:()=>c.selectedCards.map(b=>b.id),set:b=>{const u=c.cards.filter(v=>b.includes(v.id));B("selection-change",u)}}),r=b=>{B("page-change",b)},t=S(null);X(()=>{I()}),q(()=>c.cards,()=>{c.cards.length>0&&setTimeout(()=>{I()},50)});const I=()=>{if(t.value){const b=t.value.querySelectorAll(".card-item");b.length>0&&we(b,{stagger:.05,ease:"back.out(1.7)"})}};return(b,u)=>{const v=s("el-checkbox"),l=s("el-tag"),d=s("el-icon"),V=s("el-button"),k=s("el-pagination");return f(),M("div",{class:"card-list-mobile",ref_key:"cardListRef",ref:t},[(f(!0),M(R,null,J(o.cards,i=>{var m,U;return f(),M("div",{key:i.id,class:"card-item"},[g("div",Ne,[g("div",je,[e(v,{modelValue:z.value,"onUpdate:modelValue":u[0]||(u[0]=P=>z.value=P),label:i.id,onClick:u[1]||(u[1]=ve(()=>{},["stop"])),class:"card-checkbox"},null,8,["modelValue","label"]),g("span",Ee,$(i.card_key),1)]),e(l,{type:i.activated?"success":"info",size:"small"},{default:a(()=>[_($(i.activated?"已激活":"未激活"),1)]),_:2},1032,["type"])]),g("div",qe,[g("div",Ae,[u[2]||(u[2]=g("span",{class:"label"},"时长",-1)),g("span",Oe,$(y(Q)(i.duration)),1)]),g("div",Le,[u[3]||(u[3]=g("span",{class:"label"},"类型",-1)),g("span",Fe,$(i.card_type),1)]),g("div",Re,[u[4]||(u[4]=g("span",{class:"label"},"设备",-1)),g("span",De,$(((m=i.hwid_list)==null?void 0:m.length)||0)+" / "+$(i.max_hwid===-1?"∞":i.max_hwid),1)]),g("div",Ge,[u[5]||(u[5]=g("span",{class:"label"},"IP",-1)),g("span",Je,$(((U=i.ip_list)==null?void 0:U.length)||0)+" / "+$(i.max_ip===-1?"∞":i.max_ip),1)]),i.note?(f(),M("div",Ke,[u[6]||(u[6]=g("span",{class:"label"},"备注",-1)),g("span",He,$(i.note),1)])):T("",!0)]),g("div",Qe,[e(V,{size:"small",onClick:P=>b.$emit("edit",i)},{default:a(()=>[e(d,null,{default:a(()=>[e(y(Y))]),_:1}),u[7]||(u[7]=_(" 编辑 ",-1))]),_:1},8,["onClick"]),e(V,{size:"small",type:"primary",onClick:P=>b.$emit("view",i)},{default:a(()=>[e(d,null,{default:a(()=>[e(y(Z))]),_:1}),u[8]||(u[8]=_(" 详情 ",-1))]),_:1},8,["onClick"]),e(V,{size:"small",type:"danger",onClick:P=>b.$emit("delete",i)},{default:a(()=>[e(d,null,{default:a(()=>[e(y(ee))]),_:1})]),_:1},8,["onClick"])])])}),128)),o.loading?(f(),M("div",We,[e(d,{class:"is-loading"},{default:a(()=>[e(y(_e))]),_:1}),u[9]||(u[9]=g("span",null,"加载中...",-1))])):T("",!0),!o.loading&&o.cards.length===0?(f(),M("div",Xe,[e(d,null,{default:a(()=>[e(y(fe))]),_:1}),u[10]||(u[10]=g("span",null,"暂无卡密",-1))])):T("",!0),o.total>0?(f(),N(k,{key:2,class:"mobile-pagination","current-page":o.page,"page-size":o.pageSize,total:o.total,small:!0,layout:"prev, pager, next",onCurrentChange:r},null,8,["current-page","page-size","total"])):T("",!0)],512)}}},Ze=O(Ye,[["__scopeId","data-v-483ba83c"]]),el={__name:"CardTable",props:{cards:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},page:{type:Number,default:1},pageSize:{type:Number,default:20},total:{type:Number,default:0}},emits:["selection-change","page-change","edit","view","delete"],setup(o,{emit:C}){const{isMobile:c,isDesktop:B}=G(),z=S([]),r=C,t=u=>{z.value=u,r("selection-change",u)},I=u=>{r("page-change",u)},b=u=>[{key:"edit",icon:Y,label:"编辑",handler:()=>r("edit",u)},{key:"view",icon:Z,label:"详情",handler:()=>r("view",u)},{key:"delete",icon:ee,label:"删除",type:"danger",divided:!0,handler:()=>r("delete",u)}];return(u,v)=>{const l=s("el-table-column"),d=s("el-tag"),V=s("el-table"),k=s("el-pagination"),i=be("loading");return f(),M("div",null,[y(c)?(f(),N(Ze,{key:1,cards:o.cards,loading:o.loading,page:o.page,"page-size":o.pageSize,total:o.total,"selected-cards":z.value,onSelectionChange:t,onPageChange:I,onEdit:v[0]||(v[0]=m=>u.$emit("edit",m)),onView:v[1]||(v[1]=m=>u.$emit("view",m)),onDelete:v[2]||(v[2]=m=>u.$emit("delete",m))},null,8,["cards","loading","page","page-size","total","selected-cards"])):(f(),M(R,{key:0},[ge((f(),N(V,{data:o.cards,style:{width:"100%"},onSelectionChange:t},{default:a(()=>[e(l,{type:"selection",width:"55"}),e(l,{prop:"card_key",label:"卡密","min-width":"200","show-overflow-tooltip":""}),e(l,{label:"状态",width:"100"},{default:a(({row:m})=>[e(d,{type:m.activated?"success":"info"},{default:a(()=>[_($(m.activated?"已激活":"未激活"),1)]),_:2},1032,["type"])]),_:1}),e(l,{label:"有效时长",width:"120"},{default:a(({row:m})=>[_($(y(Q)(m.duration)),1)]),_:1}),e(l,{prop:"card_type",label:"类型",width:"100"}),e(l,{prop:"note",label:"备注","min-width":"120","show-overflow-tooltip":""}),e(l,{label:"设备限制",width:"120"},{default:a(({row:m})=>{var U;return[_($(((U=m.hwid_list)==null?void 0:U.length)||0)+" / "+$(m.max_hwid===-1?"∞":m.max_hwid),1)]}),_:1}),e(l,{label:"IP限制",width:"120"},{default:a(({row:m})=>{var U;return[_($(((U=m.ip_list)==null?void 0:U.length)||0)+" / "+$(m.max_ip===-1?"∞":m.max_ip),1)]}),_:1}),e(l,{label:"操作",width:"250",fixed:y(B)?"right":!1,"class-name":"action-column"},{default:a(({row:m})=>[e(Ce,{actions:b(m)},null,8,["actions"])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[i,o.loading]]),o.total>0?(f(),N(k,{key:0,style:{"margin-top":"20px","justify-content":"flex-end"},"current-page":o.page,"page-size":o.pageSize,total:o.total,layout:"total, prev, pager, next",onCurrentChange:I},null,8,["current-page","page-size","total"])):T("",!0)],64))])}}},ll=O(el,[["__scopeId","data-v-a2a65adb"]]),tl={class:"modern-dialog theme-success"},al={style:{display:"flex",gap:"10px","align-items":"center"}},ol={__name:"CardCreateDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(o,{emit:C}){const{isMobile:c}=G(),B=o,z=C,r=S(!1),t=S({mode:"batch",card_key:"",prefix:"",suffix:"",count:10,duration_value:30,duration_unit:"day",card_type:"normal",max_hwid:-1,max_ip:-1,note:""});q(()=>B.visible,l=>{r.value=l,l&&I()}),q(r,l=>{z("update:visible",l)});const I=()=>{t.value={mode:"batch",card_key:"",prefix:"",suffix:"",count:10,duration_value:30,duration_unit:"day",card_type:"normal",max_hwid:-1,max_ip:-1,note:""}},b=()=>{r.value=!1},u=()=>{z("save",t.value)},v=()=>{le(()=>{const l=document.querySelectorAll(".el-form-item");l.length>0&&te(l)})};return(l,d)=>{const V=s("el-radio"),k=s("el-radio-group"),i=s("el-form-item"),m=s("el-input"),U=s("el-input-number"),P=s("el-option"),A=s("el-select"),x=s("el-form"),L=s("el-button"),w=s("el-dialog");return f(),M("div",tl,[e(w,{modelValue:r.value,"onUpdate:modelValue":d[11]||(d[11]=h=>r.value=h),title:"生成卡密",width:y(c)?"95%":"600px",fullscreen:y(c),"close-on-click-modal":!1,onClose:b,onOpened:v},{footer:a(()=>[e(L,{onClick:b},{default:a(()=>[...d[17]||(d[17]=[_("取消",-1)])]),_:1}),e(L,{type:"primary",onClick:u},{default:a(()=>[...d[18]||(d[18]=[_("确定",-1)])]),_:1})]),default:a(()=>[e(x,{model:t.value,"label-width":y(c)?"0px":"120px","label-position":y(c)?"top":"right"},{default:a(()=>[e(i,{label:"生成方式"},{default:a(()=>[e(k,{modelValue:t.value.mode,"onUpdate:modelValue":d[0]||(d[0]=h=>t.value.mode=h)},{default:a(()=>[e(V,{label:"batch"},{default:a(()=>[...d[12]||(d[12]=[_("批量生成",-1)])]),_:1}),e(V,{label:"custom"},{default:a(()=>[...d[13]||(d[13]=[_("自定义卡密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t.value.mode==="custom"?(f(),N(i,{key:0,label:"自定义卡密"},{default:a(()=>[e(m,{modelValue:t.value.card_key,"onUpdate:modelValue":d[1]||(d[1]=h=>t.value.card_key=h),placeholder:"输入完整卡密"},null,8,["modelValue"])]),_:1})):T("",!0),t.value.mode==="batch"?(f(),M(R,{key:1},[e(i,{label:"前缀"},{default:a(()=>[e(m,{modelValue:t.value.prefix,"onUpdate:modelValue":d[2]||(d[2]=h=>t.value.prefix=h)},null,8,["modelValue"])]),_:1}),e(i,{label:"后缀"},{default:a(()=>[e(m,{modelValue:t.value.suffix,"onUpdate:modelValue":d[3]||(d[3]=h=>t.value.suffix=h)},null,8,["modelValue"])]),_:1}),e(i,{label:"生成数量"},{default:a(()=>[e(U,{modelValue:t.value.count,"onUpdate:modelValue":d[4]||(d[4]=h=>t.value.count=h),min:1,max:1e3},null,8,["modelValue"])]),_:1})],64)):T("",!0),e(i,{label:"有效时长"},{default:a(()=>[g("div",al,[e(U,{modelValue:t.value.duration_value,"onUpdate:modelValue":d[5]||(d[5]=h=>t.value.duration_value=h),min:0,style:{width:"150px"}},null,8,["modelValue"]),e(A,{modelValue:t.value.duration_unit,"onUpdate:modelValue":d[6]||(d[6]=h=>t.value.duration_unit=h),style:{width:"100px"}},{default:a(()=>[e(P,{label:"秒",value:"second"}),e(P,{label:"天",value:"day"}),e(P,{label:"周",value:"week"}),e(P,{label:"月",value:"month"}),e(P,{label:"季",value:"quarter"}),e(P,{label:"年",value:"year"})]),_:1},8,["modelValue"])]),d[14]||(d[14]=g("div",{style:{color:"#999","font-size":"12px","margin-top":"5px"}},"0表示永久",-1))]),_:1}),e(i,{label:"卡密类型"},{default:a(()=>[e(m,{modelValue:t.value.card_type,"onUpdate:modelValue":d[7]||(d[7]=h=>t.value.card_type=h),placeholder:"normal"},null,8,["modelValue"])]),_:1}),e(i,{label:"设备码上限"},{default:a(()=>[e(U,{modelValue:t.value.max_hwid,"onUpdate:modelValue":d[8]||(d[8]=h=>t.value.max_hwid=h),min:-1},null,8,["modelValue"]),d[15]||(d[15]=g("div",{style:{color:"#999","font-size":"12px","margin-top":"5px"}},"-1表示无限制",-1))]),_:1}),e(i,{label:"IP上限"},{default:a(()=>[e(U,{modelValue:t.value.max_ip,"onUpdate:modelValue":d[9]||(d[9]=h=>t.value.max_ip=h),min:-1},null,8,["modelValue"]),d[16]||(d[16]=g("div",{style:{color:"#999","font-size":"12px","margin-top":"5px"}},"-1表示无限制",-1))]),_:1}),e(i,{label:"备注"},{default:a(()=>[e(m,{modelValue:t.value.note,"onUpdate:modelValue":d[10]||(d[10]=h=>t.value.note=h),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-width","label-position"])]),_:1},8,["modelValue","width","fullscreen"])])}}},nl=O(ol,[["__scopeId","data-v-33dcf4c7"]]),dl={class:"modern-dialog theme-info"},ul={style:{display:"flex",gap:"10px","align-items":"center"}},il={__name:"CardEditDialog",props:{visible:{type:Boolean,default:!1},cardData:{type:Object,default:null}},emits:["update:visible","save"],setup(o,{emit:C}){const{isMobile:c}=G(),B=o,z=C,r=S(!1),t=S({id:null,duration_value:30,duration_unit:"day",card_type:"normal",max_hwid:-1,max_ip:-1,note:"",custom_data:""});q(()=>B.visible,v=>{r.value=v}),q(()=>B.cardData,v=>{v&&(t.value={...v})}),q(r,v=>{z("update:visible",v)});const I=()=>{r.value=!1},b=()=>{z("save",t.value)},u=()=>{le(()=>{const v=document.querySelectorAll(".el-form-item");v.length>0&&te(v)})};return(v,l)=>{const d=s("el-input-number"),V=s("el-option"),k=s("el-select"),i=s("el-form-item"),m=s("el-input"),U=s("el-form"),P=s("el-button"),A=s("el-dialog");return f(),M("div",dl,[e(A,{modelValue:r.value,"onUpdate:modelValue":l[7]||(l[7]=x=>r.value=x),title:"编辑卡密",width:y(c)?"95%":"600px",fullscreen:y(c),"close-on-click-modal":!1,onClose:I,onOpened:u},{footer:a(()=>[e(P,{onClick:I},{default:a(()=>[...l[11]||(l[11]=[_("取消",-1)])]),_:1}),e(P,{type:"primary",onClick:b},{default:a(()=>[...l[12]||(l[12]=[_("保存",-1)])]),_:1})]),default:a(()=>[e(U,{model:t.value,"label-width":y(c)?"0px":"120px","label-position":y(c)?"top":"right"},{default:a(()=>[e(i,{label:"有效时长"},{default:a(()=>[g("div",ul,[e(d,{modelValue:t.value.duration_value,"onUpdate:modelValue":l[0]||(l[0]=x=>t.value.duration_value=x),min:0,style:{width:"150px"}},null,8,["modelValue"]),e(k,{modelValue:t.value.duration_unit,"onUpdate:modelValue":l[1]||(l[1]=x=>t.value.duration_unit=x),style:{width:"100px"}},{default:a(()=>[e(V,{label:"秒",value:"second"}),e(V,{label:"天",value:"day"}),e(V,{label:"周",value:"week"}),e(V,{label:"月",value:"month"}),e(V,{label:"季",value:"quarter"}),e(V,{label:"年",value:"year"})]),_:1},8,["modelValue"])]),l[8]||(l[8]=g("div",{style:{color:"#999","font-size":"12px","margin-top":"5px"}},"0表示永久",-1))]),_:1}),e(i,{label:"卡密类型"},{default:a(()=>[e(m,{modelValue:t.value.card_type,"onUpdate:modelValue":l[2]||(l[2]=x=>t.value.card_type=x),placeholder:"normal"},null,8,["modelValue"])]),_:1}),e(i,{label:"设备码上限"},{default:a(()=>[e(d,{modelValue:t.value.max_hwid,"onUpdate:modelValue":l[3]||(l[3]=x=>t.value.max_hwid=x),min:-1},null,8,["modelValue"]),l[9]||(l[9]=g("div",{style:{color:"#999","font-size":"12px","margin-top":"5px"}},"-1表示无限制",-1))]),_:1}),e(i,{label:"IP上限"},{default:a(()=>[e(d,{modelValue:t.value.max_ip,"onUpdate:modelValue":l[4]||(l[4]=x=>t.value.max_ip=x),min:-1},null,8,["modelValue"]),l[10]||(l[10]=g("div",{style:{color:"#999","font-size":"12px","margin-top":"5px"}},"-1表示无限制",-1))]),_:1}),e(i,{label:"备注"},{default:a(()=>[e(m,{modelValue:t.value.note,"onUpdate:modelValue":l[5]||(l[5]=x=>t.value.note=x),type:"textarea"},null,8,["modelValue"])]),_:1}),e(i,{label:"专属信息"},{default:a(()=>[e(m,{modelValue:t.value.custom_data,"onUpdate:modelValue":l[6]||(l[6]=x=>t.value.custom_data=x),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-width","label-position"])]),_:1},8,["modelValue","width","fullscreen"])])}}},sl=O(il,[["__scopeId","data-v-6e8db6fc"]]),rl={key:0},ml={key:0},pl={__name:"CardDetailDialog",props:{visible:{type:Boolean,default:!1},card:{type:Object,default:null}},emits:["update:visible"],setup(o,{emit:C}){const{isMobile:c}=G(),B=o,z=C,r=S(!1);q(()=>B.visible,I=>{r.value=I}),q(r,I=>{z("update:visible",I)});const t=()=>{r.value=!1};return(I,b)=>{const u=s("el-descriptions-item"),v=s("el-tag"),l=s("el-descriptions"),d=s("el-button"),V=s("el-dialog");return f(),N(V,{modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=k=>r.value=k),title:"卡密详情",width:"700px",onClose:t},{footer:a(()=>[e(d,{onClick:t},{default:a(()=>[...b[1]||(b[1]=[_("关闭",-1)])]),_:1})]),default:a(()=>[o.card?(f(),N(l,{key:0,column:y(c)?1:2,border:""},{default:a(()=>[e(u,{label:"卡密"},{default:a(()=>[_($(o.card.card_key),1)]),_:1}),e(u,{label:"状态"},{default:a(()=>[e(v,{type:o.card.activated?"success":"info"},{default:a(()=>[_($(o.card.activated?"已激活":"未激活"),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"时长"},{default:a(()=>[_($(y(Q)(o.card.duration)),1)]),_:1}),e(u,{label:"类型"},{default:a(()=>[_($(o.card.card_type),1)]),_:1}),e(u,{label:"设备码列表",span:2},{default:a(()=>[(f(!0),M(R,null,J(o.card.hwid_list,k=>(f(),N(v,{key:k,style:{"margin-right":"5px"}},{default:a(()=>[_($(k),1)]),_:2},1024))),128)),!o.card.hwid_list||o.card.hwid_list.length===0?(f(),M("span",rl,"无")):T("",!0)]),_:1}),e(u,{label:"IP列表",span:2},{default:a(()=>[(f(!0),M(R,null,J(o.card.ip_list,k=>(f(),N(v,{key:k,style:{"margin-right":"5px"}},{default:a(()=>[_($(k),1)]),_:2},1024))),128)),!o.card.ip_list||o.card.ip_list.length===0?(f(),M("span",ml,"无")):T("",!0)]),_:1}),e(u,{label:"备注",span:2},{default:a(()=>[_($(o.card.note||"无"),1)]),_:1}),e(u,{label:"专属信息",span:2},{default:a(()=>[_($(o.card.custom_data||"无"),1)]),_:1})]),_:1},8,["column"])):T("",!0)]),_:1},8,["modelValue"])}}},cl=O(pl,[["__scopeId","data-v-58d243de"]]),vl={key:0,style:{display:"flex",gap:"10px","align-items":"center"}},_l={__name:"CardBatchUpdateDialog",props:{visible:{type:Boolean,default:!1},selectedCount:{type:Number,default:0}},emits:["update:visible","save"],setup(o,{emit:C}){const{isMobile:c}=G(),B=o,z=C,r=S(!1),t=S({update_duration:!1,duration_value:30,duration_unit:"day",update_card_type:!1,card_type:"normal",update_max_hwid:!1,max_hwid:-1,update_max_ip:!1,max_ip:-1,update_note:!1,note:""});q(()=>B.visible,v=>{r.value=v,v&&I()}),q(r,v=>{z("update:visible",v)});const I=()=>{t.value={update_duration:!1,duration_value:30,duration_unit:"day",update_card_type:!1,card_type:"normal",update_max_hwid:!1,max_hwid:-1,update_max_ip:!1,max_ip:-1,update_note:!1,note:""}},b=()=>{r.value=!1},u=()=>{z("save",t.value)};return(v,l)=>{const d=s("el-alert"),V=s("el-checkbox"),k=s("el-input-number"),i=s("el-option"),m=s("el-select"),U=s("el-form-item"),P=s("el-input"),A=s("el-form"),x=s("el-button"),L=s("el-dialog");return f(),N(L,{modelValue:r.value,"onUpdate:modelValue":l[11]||(l[11]=w=>r.value=w),title:"批量修改卡密",width:"600px",onClose:b},{footer:a(()=>[e(x,{onClick:b},{default:a(()=>[...l[17]||(l[17]=[_("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:u},{default:a(()=>[...l[18]||(l[18]=[_("确定",-1)])]),_:1})]),default:a(()=>[e(d,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:a(()=>[_(" 已选择 "+$(o.selectedCount)+" 个卡密,只修改填写的字段 ",1)]),_:1}),e(A,{model:t.value,"label-width":y(c)?"0px":"120px","label-position":y(c)?"top":"right"},{default:a(()=>[e(U,{label:"有效时长"},{default:a(()=>[e(V,{modelValue:t.value.update_duration,"onUpdate:modelValue":l[0]||(l[0]=w=>t.value.update_duration=w),style:{"margin-bottom":"10px"}},{default:a(()=>[...l[12]||(l[12]=[_(" 修改时长 ",-1)])]),_:1},8,["modelValue"]),t.value.update_duration?(f(),M("div",vl,[e(k,{modelValue:t.value.duration_value,"onUpdate:modelValue":l[1]||(l[1]=w=>t.value.duration_value=w),min:0,style:{width:"150px"}},null,8,["modelValue"]),e(m,{modelValue:t.value.duration_unit,"onUpdate:modelValue":l[2]||(l[2]=w=>t.value.duration_unit=w),style:{width:"100px"}},{default:a(()=>[e(i,{label:"秒",value:"second"}),e(i,{label:"天",value:"day"}),e(i,{label:"周",value:"week"}),e(i,{label:"月",value:"month"}),e(i,{label:"季",value:"quarter"}),e(i,{label:"年",value:"year"})]),_:1},8,["modelValue"])])):T("",!0)]),_:1}),e(U,{label:"卡密类型"},{default:a(()=>[e(V,{modelValue:t.value.update_card_type,"onUpdate:modelValue":l[3]||(l[3]=w=>t.value.update_card_type=w),style:{"margin-bottom":"10px"}},{default:a(()=>[...l[13]||(l[13]=[_(" 修改类型 ",-1)])]),_:1},8,["modelValue"]),t.value.update_card_type?(f(),N(P,{key:0,modelValue:t.value.card_type,"onUpdate:modelValue":l[4]||(l[4]=w=>t.value.card_type=w),placeholder:"normal"},null,8,["modelValue"])):T("",!0)]),_:1}),e(U,{label:"设备码上限"},{default:a(()=>[e(V,{modelValue:t.value.update_max_hwid,"onUpdate:modelValue":l[5]||(l[5]=w=>t.value.update_max_hwid=w),style:{"margin-bottom":"10px"}},{default:a(()=>[...l[14]||(l[14]=[_(" 修改设备码上限 ",-1)])]),_:1},8,["modelValue"]),t.value.update_max_hwid?(f(),N(k,{key:0,modelValue:t.value.max_hwid,"onUpdate:modelValue":l[6]||(l[6]=w=>t.value.max_hwid=w),min:-1},null,8,["modelValue"])):T("",!0)]),_:1}),e(U,{label:"IP上限"},{default:a(()=>[e(V,{modelValue:t.value.update_max_ip,"onUpdate:modelValue":l[7]||(l[7]=w=>t.value.update_max_ip=w),style:{"margin-bottom":"10px"}},{default:a(()=>[...l[15]||(l[15]=[_(" 修改IP上限 ",-1)])]),_:1},8,["modelValue"]),t.value.update_max_ip?(f(),N(k,{key:0,modelValue:t.value.max_ip,"onUpdate:modelValue":l[8]||(l[8]=w=>t.value.max_ip=w),min:-1},null,8,["modelValue"])):T("",!0)]),_:1}),e(U,{label:"备注"},{default:a(()=>[e(V,{modelValue:t.value.update_note,"onUpdate:modelValue":l[9]||(l[9]=w=>t.value.update_note=w),style:{"margin-bottom":"10px"}},{default:a(()=>[...l[16]||(l[16]=[_(" 修改备注 ",-1)])]),_:1},8,["modelValue"]),t.value.update_note?(f(),N(P,{key:0,modelValue:t.value.note,"onUpdate:modelValue":l[10]||(l[10]=w=>t.value.note=w),type:"textarea"},null,8,["modelValue"])):T("",!0)]),_:1})]),_:1},8,["model","label-width","label-position"])]),_:1},8,["modelValue"])}}},fl=O(_l,[["__scopeId","data-v-fb7f6e2d"]]),bl={class:"page-container"},gl={class:"header-actions"},yl={__name:"Cards",setup(o){const C=ye(),{isMobile:c}=G(),B=S(!1),z=S([]),r=S(null),t=S([]),{page:I,pageSize:b,total:u,handlePageChange:v}=Be(),{selectedItems:l,handleSelectionChange:d}=he(),V=S(!1),k=S(!1),i=S(!1),m=S(!1),U=S(null),P=S(null),A=async()=>{try{z.value=await ke(),C.params.projectId&&(r.value=parseInt(C.params.projectId),x())}catch(n){console.error(n)}},x=async()=>{if(r.value){B.value=!0;try{const n=await Ue({project_id:r.value,page:I.value,page_size:b.value});t.value=n.list||[],u.value=n.total||0}catch(n){console.error(n)}finally{B.value=!1}}},L=n=>{v(n),x()},w=()=>{V.value=!0},h=async n=>{try{const p=H(n.duration_value,n.duration_unit),E={project_id:r.value,duration:p,card_type:n.card_type,max_hwid:n.max_hwid,max_ip:n.max_ip,note:n.note};n.mode==="custom"?(E.card_key=n.card_key,E.count=1):(E.prefix=n.prefix,E.suffix=n.suffix,E.count=n.count),await $e(E),F.success("生成成功"),V.value=!1,x()}catch(p){console.error(p)}},ae=n=>{const{value:p,unit:E}=Te(n.duration);P.value={id:n.id,duration_value:p,duration_unit:E,card_type:n.card_type,max_hwid:n.max_hwid,max_ip:n.max_ip,note:n.note,custom_data:n.custom_data||""},k.value=!0},oe=async n=>{try{const p=H(n.duration_value,n.duration_unit);await Se(n.id,{duration:p,card_type:n.card_type,max_hwid:n.max_hwid,max_ip:n.max_ip,note:n.note,custom_data:n.custom_data}),F.success("保存成功"),k.value=!1,x()}catch(p){console.error(p)}},ne=n=>{U.value={...n},i.value=!0},de=n=>{W.confirm("确定要删除该卡密吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ze(n.id),F.success("删除成功"),x()}catch(p){console.error(p)}}).catch(()=>{})},ue=()=>{m.value=!0},ie=async n=>{try{const p={};if(n.update_duration&&(p.duration=H(n.duration_value,n.duration_unit)),n.update_card_type&&(p.card_type=n.card_type),n.update_max_hwid&&(p.max_hwid=n.max_hwid),n.update_max_ip&&(p.max_ip=n.max_ip),n.update_note&&(p.note=n.note),Object.keys(p).length===0){F.warning("请至少选择一个要修改的字段");return}await Ie({ids:l.value.map(E=>E.id),data:p}),F.success(`成功更新 ${l.value.length} 个卡密`),m.value=!1,l.value=[],x()}catch(p){console.error(p)}},se=()=>{W.confirm(`确定要删除选中的 ${l.value.length} 个卡密吗?`,"批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Pe({ids:l.value.map(n=>n.id)}),F.success(`成功删除 ${l.value.length} 个卡密`),l.value=[],x()}catch(n){console.error(n)}}).catch(()=>{})};return X(()=>{A()}),(n,p)=>{const E=s("el-option"),re=s("el-select"),me=s("el-icon"),K=s("el-button"),pe=s("el-card");return f(),M("div",bl,[e(pe,null,{default:a(()=>[g("div",gl,[e(re,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=j=>r.value=j),placeholder:"选择项目",style:xe(y(c)?"width: 100%; order: -1;":"width: 300px; margin-right: 10px;"),onChange:x},{default:a(()=>[(f(!0),M(R,null,J(z.value,j=>(f(),N(E,{key:j.id,label:j.name,value:j.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","style"]),e(K,{type:"primary",onClick:w,disabled:!r.value},{default:a(()=>[e(me,null,{default:a(()=>[e(y(Ve))]),_:1}),p[5]||(p[5]=_(" 生成卡密 ",-1))]),_:1},8,["disabled"]),e(K,{type:"warning",onClick:ue,disabled:y(l).length===0,style:{"margin-left":"10px"}},{default:a(()=>[...p[6]||(p[6]=[_(" 批量修改 ",-1)])]),_:1},8,["disabled"]),e(K,{type:"danger",onClick:se,disabled:y(l).length===0},{default:a(()=>[...p[7]||(p[7]=[_(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),e(ll,{cards:t.value,loading:B.value,page:y(I),"page-size":y(b),total:y(u),onSelectionChange:y(d),onPageChange:L,onEdit:ae,onView:ne,onDelete:de},null,8,["cards","loading","page","page-size","total","onSelectionChange"])]),_:1}),e(nl,{visible:V.value,"onUpdate:visible":p[1]||(p[1]=j=>V.value=j),onSave:h},null,8,["visible"]),e(sl,{visible:k.value,"onUpdate:visible":p[2]||(p[2]=j=>k.value=j),"card-data":P.value,onSave:oe},null,8,["visible","card-data"]),e(cl,{visible:i.value,"onUpdate:visible":p[3]||(p[3]=j=>i.value=j),card:U.value},null,8,["visible","card"]),e(fl,{visible:m.value,"onUpdate:visible":p[4]||(p[4]=j=>m.value=j),"selected-count":y(l).length,onSave:ie},null,8,["visible","selected-count"])])}}},hl=O(yl,[["__scopeId","data-v-ec1afab5"]]);export{hl as default};
